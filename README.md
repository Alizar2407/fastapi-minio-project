# FastAPI + MinIO  project

В данном репозитории представлено небольшое веб-приложение, которое позволяет авторизовавшимся пользователям загружать файлы в личное S3-хранилище **MinIO** с помощью временной ссылки и скачивать ранее загруженные файлы.

- Для работы S3-хранилища **MinIO** используется контейнер
- Информация о пользователях хранится в базе данных, например **PostgreSQL**
- Бэкенд реализован с использованием фреймворка **FastAPI** в связке с **SQLAlchemy**
- Для реализации фронтенд-части приложения использовался шаблонизатор **Jinja2** и библиотека **Boostrap**

## Установка зависимостей

Для установки зависимостей можно использовать `poetry`:
```bash
poetry install
```

Также можно установить необходимые модули с помощью `pip`:
```bash
pip install -r requirements.txt
```

## Запуск приложения

### 1. Запуск контейнеров **MinIO**

В файле `docker-compose.yaml` описано 2 контейнера **MinIO**: 

- первый контейнер является основным и имеет следующие порты:
    - порт `9000` для доступа к **API** **MinIO**, которое может использоваться, например, для загрузки файла в хранилище
    - порт `9001` для веб-интерфейса **MinIO** (*MinIO console*), позволяющего отслеживать текущее состояние S3-хранилища в браузере

- второй контейнер используется для тестирования и имеет следующие порты:
    - порт `9002` для доступа к **API** **MinIO**
    - порт `9003` для веб-интерфейса **MinIO**

Запуск второго (тестового) контейнера не обязателен для работы приложения, поэтому можно удалить соответствующий раздел из файла `docker-compose.yaml`.

Для запуска контейнеров можно использовать следующую команду:
```bash
docker-compose up
```

### 2. Запуск основного приложения

Запуск основного приложения выполняется с помощью следующей команды:
```bash
uvicorn app.main:app
```

## Файл конфигурации

Для работы приложения необходимо, чтобы в директории с проектом располагался файл `.env`, содержащий следующие значения:

    DB_HOST=...
    DB_PORT=...
    DB_USER=...
    DB_PASS=...
    DB_NAME=...

    MINIO_ENDPOINT=...
    MINIO_ACCESS_KEY=...
    MINIO_SECRET_KEY=...

    MINIO_ENDPOINT_TEST=...
    MINIO_ACCESS_KEY_TEST=...
    MINIO_SECRET_KEY_TEST=...

## Тестирование

Для тестирования используется отдельная база данных и отдельное S3-хранилище. Поэтому перед выполнением тестов нужно убедиться, что запущены оба контейнера **MinIO**.

Для выполнения тестов нужно использовать следующую команду в директории с проектом:
```
pytest
```
